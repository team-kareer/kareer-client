name: Auto Labeler

on:
  issues:
    types: [opened]
  pull_request_target:
    types: [opened, reopened, synchronize]
    branches: [develop]

jobs:
  labeler:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
      pull-requests: write

    steps:
      # PR ì œëª© ê¸°ë°˜ ë¼ë²¨ë§
      - name: Label based on PR title
        if: github.event_name == 'pull_request_target'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const title = context.payload.pull_request.title;
            const labels = [];

            const labelPatterns = {
              'ğŸ› FIX': /\b(fix|Fix|FIX|bug|Bug|BUG|hotfix|Hotfix|HOTFIX|HotFix)\b/i,
              'â­ï¸ FEAT': /\b(feat|Feat|FEAT|feature|Feature|FEATURE)\b/i,
              'âœï¸ DOCS': /\b(docs|Docs|DOCS|documentation|Documentation)\b/i,
              'ğŸ‰ INIT': /\b(init|Init|INIT|initialize|Initialize)\b/i,
              'ğŸ§ STYLE': /\b(style|Style|STYLE|design|Design|DESIGN)\b/i,
              'ğŸ§¹ CHORE': /\b(chore|Chore|CHORE)\b/i,
              'ğŸ› ï¸ REFACTOR': /\b(refactor|Refactor|REFACTOR)\b/i,
              'ğŸ” TEST': /\b(test|Test|TEST)\b/i,
              'ğŸš€ DEPLOY': /\b(deploy|Deploy|DEPLOY)\b/i
            };

            for (const [label, pattern] of Object.entries(labelPatterns)) {
              if (pattern.test(title)) {
                labels.push(label);
              }
            }

            if (labels.length > 0) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.pull_request.number,
                labels: labels
              });
            }

      # ì‚¬ìš©ì ê¸°ë°˜ ë¼ë²¨ë§
      - name: Add labels based on user
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const author = context.payload.pull_request 
              ? context.payload.pull_request.user.login 
              : context.payload.issue.user.login;

            const userLabels = {
              "jeonghoon11": "ğŸ¦Š ì •í›ˆ",
              "huniversal": "ğŸ¶ í›ˆì§„",
              "sonnnnhe": "ğŸ¯ í•˜ì€",
              "yooncandooit": "ğŸª¼ ìœ¤ì§€"
            };

            const labelToAdd = userLabels[author];

            if (labelToAdd) {
              const issueNumber = context.payload.pull_request 
                ? context.payload.pull_request.number 
                : context.payload.issue.number;
              
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issueNumber,
                labels: [labelToAdd]
              });
            }
