name: Auto Labeler

on:
  issues:
    types: [opened]
  pull_request_target:
    types: [opened, reopened]
    branches: [develop]

jobs:
  labeler:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
      pull-requests: write

    steps:
      # ì œëª© ê¸°ë°˜ ë¼ë²¨ë§
      - name: Auto Labeling based on title
        if: github.event_name == 'pull_request_target' || github.event_name == 'issues'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const payload = context.payload;
            const isPR = !!payload.pull_request;
            const target = isPR ? payload.pull_request : payload.issue;

            const title = target.title;
            const author = target.user.login;
            const issueNumber = target.number;

            const labelsToAdd = [];

            // ì œëª© ê¸°ë°˜ ë¼ë²¨ ë§¤ì¹­
            const labelPatterns = {
              'ğŸ› FIX': /\b(fix|Fix|FIX|bug|Bug|BUG|hotfix|Hotfix|HOTFIX|HotFix)\b/i,
              'â­ï¸ FEAT': /\b(feat|Feat|FEAT|feature|Feature|FEATURE)\b/i,
              'âœï¸ DOCS': /\b(docs|Docs|DOCS)\b/i,
              'ğŸ‰ INIT': /\b(init|Init|INIT)\b/i,
              'ğŸ§ STYLE': /\b(style|Style|STYLE|design|Design|DESIGN)\b/i,
              'ğŸ§¹ CHORE': /\b(chore|Chore|CHORE)\b/i,
              'ğŸ› ï¸ REFACTOR': /\b(refactor|Refactor|REFACTOR)\b/i,
              'ğŸ” TEST': /\b(test|Test|TEST)\b/i,
              'ğŸš€ DEPLOY': /\b(deploy|Deploy|DEPLOY)\b/i
            };

            // ì œëª©ì—ì„œ íŒ¨í„´ ë§¤ì¹­
            for (const [label, pattern] of Object.entries(labelPatterns)) {
              if (pattern.test(title)) {
                labelsToAdd.push(label);
              }
            }

            // ì‚¬ìš©ì ê¸°ë°˜ ë¼ë²¨ ë§¤ì¹­
            const userLabels = {
              "jeonghoon11": "ğŸ¦Š ì •í›ˆ", 
              "huniversal": "ğŸ¶ í›ˆì§„",
              "sonnnnhe": "ğŸ¯ í•˜ì€",
              "yooncandooit": "ğŸª¼ ìœ¤ì§€"
            };

            if (userLabels[author]) {
              labelsToAdd.push(userLabels[author]);
            }

            const uniqueLabels = [...new Set(labelsToAdd)];

            if (uniqueLabels.length > 0) {
              try {
                await github.rest.issues.addLabels({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: issueNumber,
                  labels: uniqueLabels
                });
              } catch (error) {
                // ë¼ë²¨ ì¶”ê°€ ì‹¤íŒ¨ ì‹œ ë¬´ì‹œ
              }
            }
